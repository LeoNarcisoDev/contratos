<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Preenchimento do Contrato</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
  <h2 class="mb-3 text-center">Preenchimento do Contrato</h2>

  <div class="d-flex justify-content-between mb-4">
    <a href="/cursos" class="btn btn-outline-primary">Gerenciar Cursos</a>
    <a href="/modelos" class="btn btn-outline-secondary">Gerenciar Modelos</a>
    <a href="/alunos_csv" class="btn btn-outline-success">Importar Alunos CSV</a>
  </div>

  <form action="/submit_contract" method="post" class="row g-3">
    <div class="col-md-12">
      <label class="form-label">Modelo de Contrato</label>
      <select name="modelo" class="form-select" required>
        {% for id, nome, descricao, categoria in modelos %}
          <option value="{{ nome }}">{{ descricao }} {% if categoria %}({{ categoria }}){% endif %}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-12">
      <label class="form-label">Curso</label>
      <select name="curso" class="form-select" required>
        {% for curso in cursos %}
          <option value="{{ curso }}">{{ curso }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6"><label class="form-label">Nome</label><input type="text" class="form-control" name="nome_aluno" required></div>
    <div class="col-md-6"><label class="form-label">CPF</label><input type="text" class="form-control" name="cpf_aluno" required></div>
    <div class="col-md-12"><label class="form-label">Endereço</label><input type="text" class="form-control" name="end_aluno" required></div>
    <div class="col-md-6"><label class="form-label">Celular</label><input type="text" class="form-control" name="tel_aluno" required></div>
    <div class="col-md-6"><label class="form-label">E-mail</label><input type="email" class="form-control" name="email_aluno" required></div>

    <div class="col-md-4">
      <label class="form-label">Forma de Pagamento</label>
      <select name="forma_de_pagamento" class="form-select" required>
        <option value="">Selecione</option>
        {% for i in range(1,11) %}
          <option value="Cartão de crédito - {{ i }}x">Cartão de crédito - {{ i }}x</option>
        {% endfor %}
        <option value="Boleto bancário">Boleto bancário</option>
        <option value="Pix">Pix</option>
      </select>
    </div>
    <div class="col-md-4"><label class="form-label">Total de cada parcela</label><input type="text" class="form-control" name="parcela_cartao" required></div>
    <div class="col-md-4"><label class="form-label">Total do Contrato</label><input type="text" class="form-control" name="total_contrato" required></div>

    <div class="col-md-6"><label class="form-label">Carga horária</label><input type="text" class="form-control" name="carga_horaria" required></div>

    <div class="col-md-4"><label class="form-label">Dia início</label><input type="text" class="form-control" name="dia_inicio" required></div>
    <div class="col-md-4">
      <label class="form-label">Mês início</label>
      <select name="mes_inicio" class="form-select" required>
        {% for mes in ['janeiro','fevereiro','março','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'] %}
          <option value="{{ mes }}">{{ mes }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4"><label class="form-label">Ano início</label><input type="text" class="form-control" name="ano_inicio" required></div>

    <div class="col-md-4"><label class="form-label">Dia término</label><input type="text" class="form-control" name="dia_termino" required></div>
    <div class="col-md-4">
      <label class="form-label">Mês término</label>
      <select name="mes_termino" class="form-select" required>
        {% for mes in ['janeiro','fevereiro','março','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'] %}
          <option value="{{ mes }}">{{ mes }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4"><label class="form-label">Ano término</label><input type="text" class="form-control" name="ano_termino" required></div>

    <div class="col-md-6"><label class="form-label">Dia da semana (1)</label><input type="text" class="form-control" name="dia_semana1" required></div>
    <div class="col-md-6"><label class="form-label">Dia da semana (2)</label><input type="text" class="form-control" name="dia_semana2" required></div>

    <div class="col-12 text-center pt-3">
      <button type="submit" class="btn btn-primary btn-lg">Gerar Contrato</button>
    </div>
  </form>
</div>

<script>
  let alunos = [];

  fetch('/static/alunos.json')
    .then(res => res.json())
    .then(data => {
      alunos = data;
      const nomeInput = document.querySelector('input[name=nome_aluno]');
      const cpfInput = document.querySelector('input[name=cpf_aluno]');
      const emailInput = document.querySelector('input[name=email_aluno]');
      const telInput = document.querySelector('input[name=tel_aluno]');
      const endInput = document.querySelector('input[name=end_aluno]');
      const cursoInput = document.querySelector('select[name=curso]');

      nomeInput.addEventListener('input', () => {
        const texto = nomeInput.value.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        const encontrado = alunos.find(a => a.nome.toLowerCase().includes(texto));
        if (encontrado) {
          nomeInput.value = encontrado.nome;
          cpfInput.value = encontrado.cpf;
          emailInput.value = encontrado.email;
          telInput.value = encontrado.tel_aluno;
          endInput.value = encontrado.endereco;

          [...cursoInput.options].forEach(opt => {
            if (opt.value.toLowerCase() === encontrado.curso.toLowerCase()) {
              cursoInput.value = opt.value;
            }
          });
        }
      });
    });
</script>
</body>
</html>
